<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net 'unsafe-eval'; style-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; font-src 'self' https://cdnjs.cloudflare.com data:; img-src 'self' data:; connect-src 'self'; object-src 'none'; base-uri 'self'; frame-ancestors 'none'; form-action 'self'">
    <title>TaskFlow</title>

    <!-- CDNs -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha384-t1nt8BQoYMLFN5p42tRAtuAAFQaCQODekUVeKKZrEnEyp4H2R0RHFz0KWpmj7i8g" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"
        integrity="sha384-smVS78N63G0uFpVH9bKdb+2YIW7Q9eFrle79imo+AWW6YLluQxAEK7kxLOt1bNex"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"
        integrity="sha384-BSxuMLxX+FCbTdYec3TbXlnMGEEM2QXTFdtDaveen71o+jswm2J36+xFqp8k4VHM"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuedraggable@2.24.3/dist/vuedraggable.umd.min.js"
        integrity="sha384-qUA1xXJiX23E4GOeW/XHtsBkV9MUcHLSjhi3FzO08mv8+W8bv5AQ1cwqLskycOTs"
        crossorigin="anonymous"></script>

    <link rel="icon" type="image/png" href="img/favicon.png">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components/workspace.css">
    <link rel="stylesheet" href="css/components/kanban-modal.css">
    <link rel="stylesheet" href="css/components/polish.css">
</head>

<body>
    <div id="app" v-cloak>
        <div v-if="store.storageWarning" class="app-notice app-notice-warning" role="status" aria-live="polite">
            <i class="fas fa-exclamation-triangle"></i> {{ store.storageWarning }}
        </div>
        <header>
            <div class="app-brand">
                <img src="img/favicon.png" alt="TaskFlow logo" class="app-logo">
                <h2 class="app-title">TaskFlow</h2>
                <workspace-switcher v-if="currentWorkspace"></workspace-switcher>

                <div class="view-toggle">
                    <button :class="{ active: currentView === 'kanban' }" @click="currentView = 'kanban'"
                        aria-label="Switch to Kanban Board"
                        title="Kanban Board">
                        <i class="fas fa-columns"></i>
                    </button>
                    <button :class="{ active: currentView === 'calendar' }" @click="currentView = 'calendar'"
                        aria-label="Switch to Calendar View"
                        title="Calendar View">
                        <i class="fas fa-calendar-alt"></i>
                    </button>
                    <button :class="{ active: currentView === 'eisenhower' }" @click="currentView = 'eisenhower'"
                        aria-label="Switch to Eisenhower Matrix View"
                        title="Eisenhower Matrix View">
                        <i class="fas fa-table-cells"></i>
                    </button>
                </div>
            </div>

            <div class="header-actions">
                <filter-bar></filter-bar>
                <search-controls></search-controls>
                <button @click="openTemplateGallery" title="Template Gallery" aria-label="Open template gallery" class="icon-btn">
                    <i class="fas fa-copy"></i>
                </button>
                <button @click="confirmDeleteAll" title="Delete All Data (Reset App)" aria-label="Delete all data" class="icon-btn delete-btn">
                    <i class="fas fa-trash-alt"></i>
                </button>
                <div class="header-icon-group">
                    <button @click="downloadBackup" title="Export Data" aria-label="Export data" class="icon-btn">
                        <i class="fas fa-download"></i>
                    </button>
                    <button @click="triggerImport" title="Import Data" aria-label="Import data" class="icon-btn">
                        <i class="fas fa-upload"></i>
                    </button>
                    <input type="file" ref="fileInput" @change="handleImport" accept=".json" class="hidden-file-input">
                </div>
                <button @click="toggleTheme" title="Toggle Theme" aria-label="Toggle theme">
                    <i class="fas" :class="appTheme === 'dark' ? 'fa-sun' : 'fa-moon'"></i>
                </button>
            </div>
        </header>

        <main>
            <kanban-board v-if="currentView === 'kanban' && currentWorkspace"
                :workspace="currentWorkspace"></kanban-board>

            <calendar-view v-else-if="currentView === 'calendar' && currentWorkspace"
                :workspace="currentWorkspace"></calendar-view>

            <eisenhower-view v-else-if="currentView === 'eisenhower' && currentWorkspace"
                :workspace="currentWorkspace"></eisenhower-view>

            <div v-else-if="!currentWorkspace" class="empty-workspace-state">
                No workspace selected. Please create one.
            </div>
        </main>

        <task-modal></task-modal>
        <template-gallery-modal></template-gallery-modal>
        <app-dialog></app-dialog>
        <app-toast></app-toast>
    </div>

    <script src="js/bootstrap/dependencyCheck.js"></script>
    <script type="module" src="js/bootstrap/startApp.js"></script>
</body>

</html>

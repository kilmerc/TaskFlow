<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net 'unsafe-eval'; style-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; font-src 'self' https://cdnjs.cloudflare.com data:; img-src 'self' data:; connect-src 'self'; worker-src 'self'; manifest-src 'self'; object-src 'none'; base-uri 'self'; frame-ancestors 'none'; form-action 'self'">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>TaskFlow</title>

    <!-- CDNs -->
    <script src="https://cdn.jsdelivr.net/npm/vue@3.5.28/dist/vue.global.prod.js"
        integrity="sha384-EyKhbIJoP1t1fKIFRNEfYKy4uy8qxs7UNS4Cab53xyXqCTUB1PCoxeFsD0G/NX9W"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.7/Sortable.min.js"
        integrity="sha384-DgmC6Xe2bSN2WjTDXzWYbUbxyhNP+NNkGDR/g78pCXV7E7rcVTGxVg0uIVCUUcBc"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuedraggable@4.1.0/dist/vuedraggable.umd.min.js"
        integrity="sha384-4d4fYdfApsS7fYSS4WOmsMfM4R4SmLZcANgHnbDWRzH3RIdOCoL/7gwQM7Kg7Lf+"
        crossorigin="anonymous"></script>

    <link rel="manifest" href="./manifest.webmanifest">
    <link rel="icon" type="image/png" href="img/favicon.png">
    <link rel="apple-touch-icon" href="./img/icons/icon-192.png">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components/workspace.css">
    <link rel="stylesheet" href="css/components/kanban-modal.css">
    <link rel="stylesheet" href="css/components/polish.css">
</head>

<body>
    <div id="app" v-cloak>
        <div v-if="store.storageWarning" class="app-notice app-notice-warning" role="status" aria-live="polite">
            <app-icon name="alert-triangle"></app-icon> {{ store.storageWarning }}
        </div>
        <header>
            <div class="app-brand">
                <img src="img/favicon.png" alt="TaskFlow logo" class="app-logo">
                <h2 class="app-title">TaskFlow</h2>
                <workspace-switcher v-if="currentWorkspace"></workspace-switcher>

                <div class="view-toggle segmented-control" role="tablist" aria-label="TaskFlow views">
                    <button :class="{ active: currentView === 'kanban' }" @click="currentView = 'kanban'"
                        aria-label="Switch to Kanban Board"
                        title="Kanban Board" role="tab" :aria-selected="currentView === 'kanban' ? 'true' : 'false'">
                        <app-icon name="layout-columns"></app-icon>
                    </button>
                    <button :class="{ active: currentView === 'calendar' }" @click="currentView = 'calendar'"
                        aria-label="Switch to Calendar View"
                        title="Calendar View" role="tab" :aria-selected="currentView === 'calendar' ? 'true' : 'false'">
                        <app-icon name="calendar-days"></app-icon>
                    </button>
                    <button :class="{ active: currentView === 'eisenhower' }" @click="currentView = 'eisenhower'"
                        aria-label="Switch to Eisenhower Matrix View"
                        title="Eisenhower Matrix View" role="tab" :aria-selected="currentView === 'eisenhower' ? 'true' : 'false'">
                        <app-icon name="layout-grid"></app-icon>
                    </button>
                </div>
            </div>

            <div class="header-actions">
                <filter-bar></filter-bar>
                <search-controls></search-controls>
                <button @click="openTemplateGallery" title="Template Gallery" aria-label="Open template gallery" class="icon-btn">
                    <app-icon name="copy"></app-icon>
                </button>
                <button @click="confirmDeleteAll" title="Delete All Data (Reset App)" aria-label="Delete all data" class="icon-btn delete-btn">
                    <app-icon name="trash"></app-icon>
                </button>
                <div class="header-icon-group">
                    <button @click="downloadBackup" title="Export Data" aria-label="Export data" class="icon-btn">
                        <app-icon name="download"></app-icon>
                    </button>
                    <button @click="triggerImport" title="Import Data" aria-label="Import data" class="icon-btn">
                        <app-icon name="upload"></app-icon>
                    </button>
                    <input type="file" ref="fileInput" @change="handleImport" accept=".json" class="hidden-file-input">
                </div>
                <button @click="toggleTheme" title="Toggle Theme" aria-label="Toggle theme">
                    <app-icon :name="appTheme === 'dark' ? 'sun' : 'moon'"></app-icon>
                </button>
            </div>
        </header>

        <main>
            <kanban-board v-if="currentView === 'kanban' && currentWorkspace"
                :workspace="currentWorkspace"></kanban-board>

            <calendar-view v-else-if="currentView === 'calendar' && currentWorkspace"
                :workspace="currentWorkspace"></calendar-view>

            <eisenhower-view v-else-if="currentView === 'eisenhower' && currentWorkspace"
                :workspace="currentWorkspace"></eisenhower-view>

            <div v-else-if="!currentWorkspace" class="empty-workspace-state">
                {{ uiCopy.labels.emptyWorkspace }}
            </div>
        </main>

        <task-modal></task-modal>
        <template-gallery-modal></template-gallery-modal>
        <app-dialog></app-dialog>
        <app-toast></app-toast>
    </div>

    <script src="js/bootstrap/dependencyCheck.js"></script>
    <script type="module" src="js/bootstrap/startApp.js"></script>
</body>

</html>
